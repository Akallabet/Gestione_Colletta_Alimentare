function getComuneById(e){var t=null;for(var i in comuni)if(comuni[i].id==e){t=angular.extend({},comuni[i]);break}return t}var comuni=[],versionTmpl="1.5",collettaApp=angular.module("collettaApp",["ngResource","ngRoute","ui.bootstrap","ui.select2"]);collettaApp.config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/login.html?version="+versionTmpl}).when("/:token/home",{templateUrl:"views/home.html?version="+versionTmpl}).when("/:token/gestione_supermercati",{templateUrl:"views/admin/supermercati.html?version="+versionTmpl}).when("/:token/gestione_utenti",{templateUrl:"views/admin/utenti.html?version="+versionTmpl}).when("/:token/gestione_magazzini",{templateUrl:"views/admin/magazzini.html?version="+versionTmpl}).when("/:token/gestione_catene",{templateUrl:"views/admin/catene.html?version="+versionTmpl}).when("/:token/gestione_files",{templateUrl:"views/admin/files.html?version="+versionTmpl}).when("/:token/gestione_report",{templateUrl:"views/user/report.html?version="+versionTmpl}).when("/:token/supermercati",{templateUrl:"views/user/supermercati.html?version="+versionTmpl}).when("/:token/prodotti/:idSupermercato",{templateUrl:"views/user/prodotti.html?version="+versionTmpl}).otherwise({redirectTo:"/"})}]),collettaApp.controller("LoginCtrl",["$scope","$resource","$location","LoginFactory","VersionService",function(e,t,i,n,o){e.version=o.version,e.alerts=[],e.closeAlerts=function(){e.alerts=[]},e.username="",e.password="",e.login=function(){if(""!==e.username&&""!==e.password){var t=new n({username:e.username,password:e.password});t.$save(function(){arguments[0].error?e.alerts.push({type:"error",disabled:!1,msg:"Nome utente o password errati, riprova!"}):(e.alerts=[],i.path(arguments[0].token+"/home/"))})}}}]),collettaApp.controller("AdminCtrl",["$scope","$resource","$location","$routeParams","UserInfoService","UserInfoFactory","AdminPagesService","LogoutFactory","VersionService",function(e,t,i,n,o,r,a,s,c){e.version=c.version,e.token=n.token,e.sections=a.sections,e.section=a.section,0==e.sections.length&&(e.sections.push({url:"supermercati",label:"Supermercati",active:!1}),e.sections.push({url:"utenti",label:"Utenti",active:!1}),e.sections.push({url:"magazzini",label:"Magazzini",active:!1})),e.sections.map(function(t){return t.active=t.url==e.section?!0:!1})}]),collettaApp.controller("UserCtrl",["$scope","$resource","$location","$routeParams","GetInfoFactory","SetInfoFactory","UserInfoService","UserInfoFactory","LogoutFactory","VersionService","CollettaService",function(e,t,i,n,o,r,a,s,c,l,u){e.version=l.version,e.activePage=n.page,e.token=n.token,e.user=a.user,e.userDef=a.def,e.userProm=a.prom,e.colletta=u.colletta,e.colletta_active=u.active,e.collettaPromise=u.collettaPromise,e.collettaDeferred=u.collettaDeferred,e.files=u.files,e.logout=function(){c.get(function(){i.path("/")})};var p=new o;p.$save({token:n.token,property:"colletta"},function(){e.colletta.length=0;for(var t=0;p.colletta.length>t;t++)e.colletta.push($.extend(p.colletta[t],{attiva:1==p.colletta[t].attiva?!0:!1}));for(var t=0;e.colletta.length>t;t++)e.colletta[t].attiva&&(u.active=$.extend({},e.colletta[t]));e.collettaDeferred.resolve()});var h=s.get({token:e.token},function(){if(h.error)i.path("/");else{switch(angular.extend(e.user,h.user),e.user.pages.length=0,e.user.pages.push({url:"supermercati",label:"Gestione Carichi",selected:0}),e.user.pages.push({url:"gestione_report",label:"Report",selected:0}),parseInt(e.user.privilegi)){case 1:e.user.pages.push({url:"gestione_supermercati",label:"Gestione Supermercati",selected:0}),e.user.pages.push({url:"gestione_files",label:"Upload",selected:0})}e.userDef.resolve()}})}]),collettaApp.controller("HomeCtrl",["$scope","$resource","$location","$routeParams","UserInfoService","VersionService",function(e,t,i,n,o,r){e.version=r.version,e.token=n.token,e.user=o.user}]);var catene=[];collettaApp.controller("SupermercatiCtrl",["$scope","$q","$resource","$location","$routeParams","$modal","GetInfoFactory","SetInfoFactory","SupermercatiService","ComuniService","CateneService","CapiEquipeService","AdminPagesService","CaricoService","VersionService","CollettaService","SupermercatoService","InsertInfoFactory","ProvincieService",function(e,t,i,n,o,r,a,s,c,l,u,p,h,d,f,m,g,v,b){function y(){}function w(){console.log(e.supTmpl)}h.section="supermercati",e.version=f.version,e.supermercati=c.supermercati=[],e.newSupermercati=c.tmpl,e.colletta=m.colletta,e.collettaPromise=m.collettaPromise,e.checkedAll=0,e.columns=[],e.getComuneById=getComuneById,e.chosenSuperm=2,e.provincie=b.provincie,e.comuni=l.comuni,e.catene=u.catene,e.capi_equipe=p.capi_equipe,e.capi_equipe_array=p.capi_equipe_array,e.capi_equipe_supermercati=p.capi_equipe_supermercati,e.supTmpl=g.tmpl,e.pagination={page:1,itemsPerPage:50,currentPage:function(){return e.pagination.page*e.pagination.itemsPerPage}},e.search={visible:!0,provincia:"",comune:"",catena:""},e.capi_equipe_deferred=t.defer(),e.capi_equipe_promise=e.capi_equipe_deferred.promise,e.capi_equipe_supermercati_deferred=t.defer(),e.capi_equipe_supermercati_promise=e.capi_equipe_supermercati_deferred.promise,e.getComuni=function(){if(0==e.comuni.length){var t=new a;t.$save({token:o.token,property:"comuni"},function(){for(var i=0;t.comuni.length>i;i++)e.comuni.push(t.comuni[i]);var n=_.uniq(e.comuni.map(function(e){return{id:e.id_provincia,nome:e.provincia}}),"id");e.provincie.length=0;for(var i=0;n.length>i;i++)e.provincie[i]=$.extend({},n[i]);l.def.resolve()})}},e.getCatene=function(){if(0==e.catene.length){var t=new a;t.$save({token:o.token,property:"catene"},function(){for(var i=0;t.catene.length>i;i++)e.catene.push(t.catene[i]);u.def.resolve(),catene=e.catene})}},e.stuffs=[{name:"thing1",desc:"this is the first thing"},{name:"thing2",desc:"this is the second thing"}],e.getCapiEquipe=function(){var t=new a;t.$save({token:o.token,property:"capi_equipe"},function(){for(var i=0;t.capi_equipe.length>i;i++)e.capi_equipe[t.capi_equipe[i].id]=$.extend({supermercati:[]},t.capi_equipe[i]),e.capi_equipe_array.push(e.capi_equipe[t.capi_equipe[i].id]);e.capi_equipe_deferred.resolve()})},e.getCapiEquipeSupermercati=function(){var t=new a;t.$save({token:o.token,property:"capi_equipe_supermercati"},function(){e.capi_equipe_supermercati=t.capi_equipe_supermercati,e.capi_equipe_supermercati_deferred.resolve()})},e.getSupermercati=function(){var t={};null!=e.search.comune&&""!=e.search.comune&&(t.id_comune=e.search.comune),null!=e.search.provincia&&""!=e.search.provincia&&(t.id_provincia=e.search.provincia),null!=e.search.catena&&""!=e.search.catena&&(t.id_catena=e.search.catena),t.id_colletta=e.colletta.filter(function(e){return 1==e.attiva})[0].id;var i=new a(t);i.$save({token:o.token,property:"supermercati"},function(){e.supermercati.length=0;for(var t=0;e.capi_equipe_supermercati.length>t;t++){var n=e.capi_equipe_supermercati[t];void 0!==e.capi_equipe[n.id_capo_equipe]&&e.capi_equipe[n.id_capo_equipe].supermercati.push(n.id_supermercato)}for(var t=0;i.supermercati.length>t;t++){i.supermercati[t].catena=e.catene.filter(function(e){return e.id==i.supermercati[t].id_catena})[0],i.supermercati[t].comune=e.comuni.filter(function(e){return e.id==i.supermercati[t].id_comune}).map(function(e){return e.nome})[0],i.supermercati[t].provincia=e.comuni.filter(function(e){return e.id==i.supermercati[t].id_comune}).map(function(e){return e.provincia})[0],i.supermercati[t].capi_equipe={};for(var o in e.capi_equipe)void 0!==e.capi_equipe[o].supermercati&&-1!=e.capi_equipe[o].supermercati.indexOf(i.supermercati[t].id)&&(i.supermercati[t].capi_equipe=$.extend({},e.capi_equipe[o]));e.supermercati.push(c.supermercato(i.supermercati[t]))}e.search.visible=!1})},e.setToggledSupermercati=function(t){var i=new s({values:[{id_supermercato:{IN:e.getAllSupermercatiIds({checked:1})}}],set:[{confermato:t}]});i.$save({token:o.token,property:"supermercati"},function(){})},e.$on("id",function(){e.getSupermercati(o.idSupermercato)}),e.$on("comuni",function(){e.getComuni()}),e.$on("catene",function(){e.getCatene()}),e.$on("capi_equipe",function(){e.getCapiEquipe(),e.getCapiEquipeSupermercati()}),t.all([e.capi_equipe_promise,e.capi_equipe_supermercati_promise,e.collettaPromise,l.prom,u.prom]).then(function(){e.getSupermercati()}),void 0!==o.idSupermercato&&e.$emit("id"),e.$emit("comuni"),e.$emit("catene"),e.$emit("capi_equipe"),e.openDetails=function(t){localStorage.supermercato=JSON.stringify(e.supermercati.filter(function(e){return e.id==t})[0]),n.path("/"+o.token+"/prodotti/"+t)},e.getAllSupermercatiIds=function(t){for(var i=[],n=0;e.supermercati.length>n;n++)if("undefined"!=t){var o=!0;for(var r in t)if(e.supermercati[n][r]!=t[r]){o=!1;break}o&&i.push(e.supermercati[n].id)}else i.push(e.supermercati[n].id);return i},e.filterFirst={initSelection:function(e,t){t($(e).data("$ngModelController").$modelValue)}},e.toggleSelected=function(){},e.enableChecked=function(){},e.disableChecked=function(){},e.incrementPagination=function(){e.supermercati.length>e.pagination.currentPage()&&e.pagination.page++},e.openNewSupermercato=function(){g.modalTitle="Nuovo Supermercato",g.modalButtons[0].active=!0,g.modalButtons[1].active=!1,g.modalButtons[2].active=!0;var e=r.open({templateUrl:"newSupermercatiModal.html",controller:SupermercatoCtrl,resolve:{}});e.result.then(function(e){"ok"==e&&w()},function(){})},e.openSetSupermercato=function(){console.log(g.mod),g.modalTitle="Modifica Supermercato",g.modalButtons[0].active=!0,g.modalButtons[1].active=!1,g.modalButtons[2].active=!0;var e=r.open({templateUrl:"supermercatiModal.html",controller:SupermercatoCtrl,resolve:{}});e.result.then(function(e){"ok"==e&&y()},function(){})}}]),collettaApp.filter("range",function(){return function(e,t,i){var n=[];if(void 0!==e){t=parseInt(t),i=parseInt(i);for(var o=t;i>o;o++)e.length>o&&n.push(e[o])}return n}});var prodotti=[],SupermercatoCtrl=function(e,t,i,n,o,r,a,s,c,l,u){e.version=s.version,e.comuni=c.comuni,e.catene=l.catene,e.capi_equipe=u.capi_equipe_array,e.modalTitle=r.modalTitle,e.modalButtons=r.modalButtons,e.supTmpl=r.tmpl,e.mod=r.mod,e.closeModal=function(e){a.close(e)}};SupermercatoCtrl.$inject=["$scope","$resource","$location","$routeParams","GetInfoFactory","SupermercatoService","$modalInstance","VersionService","ComuniService","CateneService","CapiEquipeService"];var prodotti=[];collettaApp.controller("ProdottiCtrl",["$scope","$resource","$location","$modal","$routeParams","GetInfoFactory","InsertInfoFactory","SetInfoFactory","DeleteInfoFactory","ComuniService","CateneService","CapiEquipeService","CaricoService","VersionService","ProdottiService",function(e,t,i,n,o,r,a,s,c,l,u,p,h,d,f){function m(){var t=e.prodotti.length>0?parseInt(e.prodotti[e.prodotti.length-1].id):0,i=e.caricoTmpl.map(function(e){return $.extend({},{id_supermercato:o.idSupermercato,id_user:"",prodotto:"'"+e.prodotto+"'",kg:""!=e.kg?e.kg:0,scatole:""!=e.scatole?e.scatole:0,carico:t+1})}),n=new a({values:i});n.$save({token:o.token,property:"prodotti"},function(){e.$emit("refresh")})}function g(t){var i=[],n=[];t.objects.map(function(e){i.push(e),n.push({id:e.id})});var r=new s({values:i,set:n});r.$save({token:o.token,property:"prodotti"},function(){e.$emit("refresh")})}function v(){for(var t=[],i=[],n=0;e.prodotti.length>n;n++)for(var r=0;e.prodotti[n].objects.length>r;r++)e.prodotti[n].objects[r].carico=n+1,t.push({carico:e.prodotti[n].objects[r].carico}),i.push({id:e.prodotti[n].objects[r].id});var a=new s({values:t,set:i});a.$save({token:o.token,property:"prodotti"},function(){e.$emit("refresh")})}function b(t){var i,n=[],r=[];e.prodotti.map(function(e,n){e.id==t.id&&(i=n)}),t.objects.map(function(e){r.push({id:e.id})}),e.prodotti.splice(i,1);var a=new c({values:n,set:r});a.$save({token:o.token,property:"prodotti"},function(){v()})}e.version=d.version,e.view=1,e.supermercato=null,e.prodottiNomi=h.prodottiNomi,e.caricoTmpl=h.caricoTmpl,e.prodotti=f.prodotti,e.prodottiByTipo=[],e.prodottiByTipoTotal=[],e.Total={kg:0,scatole:0},e.prodottiCarichi={},e.prodottiLength=0,e.lastCarico=1,e.modifyId=h.modifyId,e.getSupermercatoById=function(){e.supermercato=$.parseJSON(localStorage.supermercato)},e.getCarichiByIdSupermercato=function(){var t=new r({id_supermercato:o.idSupermercato});t.$save({token:o.token,property:"prodotti"},function(){if(void 0!==t.prodotti){e.prodotti.length=0;var i=_.groupBy(t.prodotti,function(e){return parseInt(e.carico)});e.prodottiByTipo=_.groupBy(t.prodotti,function(e){return e.prodotto});var n=1;for(var o in i)e.prodotti.push($.extend({},{id:i[o][0].carico,objects:i[o]})),n++;e.getProdottiByTipoTotal(),e.prodottiLength=e.prodotti.length,h.lastId=e.prodottiLength>0?e.prodotti[e.prodotti.length-1].objects[0].carico:0}})},e.$on("refresh",function(){e.getCarichiByIdSupermercato(),e.getSupermercatoById()}),e.$emit("refresh"),e.isNaN=isNaN,e.parseInt=parseInt,e.getCaricoTotal=function(e){for(var t={kg:0,scatole:0},i=0;e.length>i;i++)t.kg+=parseFloat(e[i].kg),t.scatole+=parseFloat(e[i].scatole);return t},e.getProdottiByTipoTotal=function(){e.Total={kg:0,scatole:0},e.prodottiByTipoTotal.length=0;for(var t in e.prodottiByTipo){for(var i={type:t,kg:0,scatole:0},n=0;e.prodottiByTipo[t].length>n;n++)i.kg+=parseFloat(e.prodottiByTipo[t][n].kg),i.scatole+=parseFloat(e.prodottiByTipo[t][n].scatole);e.Total.kg+=parseFloat(i.kg),e.Total.scatole+=parseFloat(i.scatole),e.prodottiByTipoTotal.push(i)}},e.openNewCarico=function(){h.modalTitle="Nuovo Carico",h.modalButtons[0].active=!0,h.modalButtons[1].active=!1,h.modalButtons[2].active=!0,e.caricoTmpl.map(function(e,t){return $.extend(e,h.newCarico[t])});var t=n.open({templateUrl:"caricoNewModal.html",controller:CaricoCtrl,resolve:{}});t.result.then(function(e){"ok"==e&&m()},function(){})},e.openSetCarico=function(t){e.modifyId=h.modifyId=t.id,h.modalTitle="Modifica Carico",h.modalButtons[0].active=!0,h.modalButtons[1].active=!0,h.modalButtons[2].active=!0,e.modifyId=t.ordine;var i=n.open({templateUrl:"caricoEditModal.html",controller:CaricoCtrl,resolve:{}});i.result.then(function(e){"ok"==e?g(t):"del"==e&&b(t)},function(){})}}]);var prodotti=[],CaricoCtrl=function(e,t,i,n,o,r,a,s,c){e.version=s.version,e.prodotti=c.prodotti,e.columns=r.prodottiNomi,e.modifyId=r.modifyId,e.caricoTmpl=r.caricoTmpl,e.carico=e.prodotti.filter(function(t){return t.id==e.modifyId})[0],e.lastId=r.lastId,e.modalTitle=r.modalTitle,e.modalButtons=r.modalButtons,e.closeModal=function(e){a.close(e)}};CaricoCtrl.$inject=["$scope","$resource","$location","$routeParams","GetInfoFactory","CaricoService","$modalInstance","VersionService","ProdottiService"],collettaApp.controller("CateneCtrl",["$scope","$resource","$location","$routeParams","GetInfoFactory","CaricoService","VersionService",function(e,t,i,n,o,r,a){e.version=a.version}]),collettaApp.controller("FilesCtrl",["$scope","$resource","$location","$routeParams","ServerAddress","SetInfoFactory","UserInfoService","VersionService","filesUpload","CollettaService",function(e,t,i,n,o,r,a,s,c,l){e.version=s.version,e.token=n.token,e.colletta=l.colletta,e.colletta_active=l.active,e.uploaded=1,e.files=l.files,e.progress=0,e.collettaPromise=l.collettaPromise,e.collettaPromise.then(function(){e.colletta_active=e.colletta.filter(function(e){return"1"==e.attiva})[0];var t=c.get({year:e.colletta_active.anno},function(){e.files.length=0;for(var i in t.files[e.colletta_active.anno])e.files.push({name:i,checked:t.files[e.colletta_active.anno][i].checked,status:t.files[e.colletta_active.anno][i].checked?1:0}),t.files[e.colletta_active.anno][i].checked||(e.uploaded=0)})}),e.getChecked=function(){for(var t=!0,i=0;e.files.length>i;i++)0==e.files[i].status&&(t=!1);return t},e.updateInfo=function(){var i=t(o.getServerAddress()+"/:token/info/update/:year",{token:n.token,year:e.colletta_active.anno}),r=i.get(function(){void 0!==r.result})},e.changeCollettaActive=function(t){for(var i=[],o=[],a=0;e.colletta.length>a;a++)e.colletta[a].attiva=e.colletta[a].anno==t.anno?!0:!1,i.push(e.colletta[a]),o.push({id:e.colletta[a].id});var s=new r({values:i,set:o});s.$save({token:n.token,property:"colletta"},function(){})}}]);var catene=[];collettaApp.controller("ReportCtrl",["$scope","$q","$resource","$location","$routeParams","$modal","GetInfoFactory","SetInfoFactory","SupermercatiService","ComuniService","CateneService","CapiEquipeService","AdminPagesService","CaricoService","VersionService","CollettaService","SupermercatoService","InsertInfoFactory","ProvincieService",function(e,t,i,n,o,r,a,s,c,l,u,p,h,d,f,m,g,v,b){h.section="report",e.version=f.version,e.report={},e.reportByComuni={},e.reportByComuniArray=[],e.reportByProvincie={},e.newSupermercati=c.tmpl,e.colletta=m.colletta,e.collettaPromise=m.collettaPromise,e.searchForm=1,e.checkedAll=0,e.columns=[],e.getComuneById=getComuneById,e.provincie=b.provincie,e.comuni=l.comuni,e.catene=u.catene,e.supTmpl=g.tmpl,e.prodottiNomi=d.prodottiNomi,e.tipiTotali={};for(var y in e.prodottiNomi)e.tipiTotali[e.prodottiNomi[y].tipo]={tipo:e.prodottiNomi[y].tipo,kg:0,scatole:0};e.totaliComplessivi={tipiArray:[],tipi:$.extend(!0,{},e.tipiTotali),complessivo:{kg:0,scatole:0,carichi:0}},e.prodotti=[],e.prodottiByTipo=[],e.prodottiByTipoTotal=[],e.Total={kg:0,scatole:0},e.prodottiCarichi={},e.pagination={page:1,itemsPerPage:50,currentPage:function(){return e.pagination.page*e.pagination.itemsPerPage}},e.limitDecimal=function(e){return 0===e%1?e:e.toFixed(2)},e.parseInt=function(e){return Math.round(e)},e.search={visible:!0,provincia:"",comune:"",catena:"",comuniId:[]},e.getComuni=function(){if(0==e.comuni.length){var t=new a;t.$save({token:o.token,property:"comuni"},function(){for(var i=0;t.comuni.length>i;i++)e.comuni.push(t.comuni[i]);var n=_.uniq(e.comuni.map(function(e){return{id:e.id_provincia,nome:e.provincia}}),"id");e.provincie.length=0;for(var i=0;n.length>i;i++)e.provincie[i]=$.extend({},n[i]);l.def.resolve()})}},e.getCatene=function(){if(0==e.catene.length){var t=new a;t.$save({token:o.token,property:"catene"},function(){for(var i=0;t.catene.length>i;i++)e.catene.push(t.catene[i]);u.def.resolve(),catene=e.catene})}},e.getSupermercati=function(){var t={};null!=e.search.comune&&""!=e.search.comune?t.id_comune=e.search.comune:null!=e.search.provincia&&""!=e.search.provincia&&(t.id_provincia=e.search.provincia),t.id_colletta=e.colletta.filter(function(e){return 1==e.attiva})[0].id;var i=new a(t);i.$save({token:o.token,property:"report"},function(){e.report={},e.reportByComuni={};for(var t=0;i.report.length>t;t++)i.report[t].catena=e.catene.filter(function(e){return e.id==i.report[t].id_catena})[0],e.report[i.report[t].id]=i.report[t],void 0===e.reportByComuni[i.report[t].id_comune]&&(e.reportByComuni[i.report[t].id_comune]={nome:e.comuni.filter(function(e){return e.id==i.report[t].id_comune})[0].nome,supermercati:[],prodotti:[],complessivo:{kg:0,scatole:0,carichi:[]},totali:{},totaliArray:[],enabled:!1}),e.reportByComuni[i.report[t].id_comune].supermercati.push($.extend({},i.report[t]));e.getCarichiByIdSupermercati(),e.search.visible=!1})},e.getCarichiByIdSupermercati=function(){var t=new a({id_supermercato:{IN:e.getAllSupermercatiIds()}});t.$save({token:o.token,property:"prodotti"},function(){if(void 0!==t.prodotti){e.prodotti.length=0,e.reportByComuniArray.length=0,e.totaliComplessivi={tipiArray:[],tipi:$.extend(!0,{},e.tipiTotali),complessivo:{kg:0,scatole:0,carichi:0}};for(var i=0;t.prodotti.length>i;i++)e.reportByComuni[e.report[t.prodotti[i].id_supermercato].id_comune].enabled=!0,e.reportByComuni[e.report[t.prodotti[i].id_supermercato].id_comune].prodotti.push($.extend({},t.prodotti[i]));for(var i in e.reportByComuni){e.reportByComuni[i].totali=$.extend(!0,{},e.tipiTotali);for(var n=0;e.reportByComuni[i].prodotti.length>n;n++)e.reportByComuni[i].totali[e.reportByComuni[i].prodotti[n].prodotto].kg+=parseFloat(e.reportByComuni[i].prodotti[n].kg),e.reportByComuni[i].totali[e.reportByComuni[i].prodotti[n].prodotto].scatole+=parseFloat(e.reportByComuni[i].prodotti[n].scatole),e.totaliComplessivi.tipi[e.reportByComuni[i].prodotti[n].prodotto].kg+=parseFloat(e.reportByComuni[i].prodotti[n].kg),e.totaliComplessivi.tipi[e.reportByComuni[i].prodotti[n].prodotto].scatole+=parseFloat(e.reportByComuni[i].prodotti[n].scatole),e.reportByComuni[i].complessivo.kg+=parseFloat(e.reportByComuni[i].prodotti[n].kg),e.reportByComuni[i].complessivo.scatole+=parseFloat(e.reportByComuni[i].prodotti[n].scatole),e.totaliComplessivi.complessivo.kg+=parseFloat(e.reportByComuni[i].prodotti[n].kg),e.totaliComplessivi.complessivo.scatole+=parseFloat(e.reportByComuni[i].prodotti[n].scatole),-1==e.reportByComuni[i].complessivo.carichi.indexOf(parseInt(e.reportByComuni[i].prodotti[n].id_supermercato))&&(e.reportByComuni[i].complessivo.carichi.push(parseInt(e.reportByComuni[i].prodotti[n].id_supermercato)),e.totaliComplessivi.complessivo.carichi++);for(var n in e.reportByComuni[i].totali)e.reportByComuni[i].totaliArray.push(e.reportByComuni[i].totali[n]);e.reportByComuniArray.push(e.reportByComuni[i])}for(var n in e.totaliComplessivi.tipi)e.totaliComplessivi.tipiArray.push(e.totaliComplessivi.tipi[n])}})},e.getReport=function(){},e.$on("comuni",function(){e.getComuni()}),e.$on("catene",function(){e.getCatene()}),t.all([e.collettaPromise,l.prom,u.prom]).then(function(){}),e.$emit("comuni"),e.$emit("catene"),e.getAllSupermercatiIds=function(t){var i=[];for(var n in e.report)if("undefined"!=t){var o=!0;for(var r in t)if(e.report[n][r]!=t[r]){o=!1;break}o&&i.push(e.report[n].id)}else i.push(e.report[n].id);return i},e.filterFirst={initSelection:function(e,t){t($(e).data("$ngModelController").$modelValue)}},e.getCaricoTotal=function(e){for(var t={kg:0,scatole:0},i=0;e.length>i;i++)t.kg+=parseFloat(e[i].kg),t.scatole+=parseFloat(e[i].scatole);return t},e.getProdottiByTipoTotal=function(){e.Total={kg:0,scatole:0},e.prodottiByTipoTotal.length=0;for(var t in e.prodottiByTipo){for(var i={type:t,kg:0,scatole:0},n=0;e.prodottiByTipo[t].length>n;n++)i.kg+=parseFloat(e.prodottiByTipo[t][n].kg),i.scatole+=parseFloat(e.prodottiByTipo[t][n].scatole);e.Total.kg+=parseFloat(i.kg),e.Total.scatole+=parseFloat(i.scatole),e.prodottiByTipoTotal.push(i)}}}]),collettaApp.filter("range",function(){return function(e,t,i){var n=[];if(void 0!==e){t=parseInt(t),i=parseInt(i);for(var o=t;i>o;o++)e.length>o&&n.push(e[o])}return n}}),collettaApp.directive("myUploader",["$routeParams","ServerAddress","CollettaService",function(){return{link:function(e,t){$(t).find(".fake-uploader").on("click",function(){$(this).parent().find('input[type="file"]').trigger("click")}),$(t).find(".fake-uploader").on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),$(t).find(".fake-uploader").on("dragenter",function(e){e.preventDefault(),e.stopPropagation()}),$(t).find(".fake-uploader").on("drop",function(e){e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length&&(e.preventDefault(),e.stopPropagation(),$(this).parent().children("input[type='file']").prop("files",e.originalEvent.dataTransfer.files))}),$(t).find('input[type="file"]').on("change",function(){e.$parent.$apply(function(){e.$parent.uploaded=!1}),$(t).find(".status-2").show(),e.$apply(function(){e.file.status=2})})}}}]),collettaApp.directive("myUpload",["$routeParams","ServerAddress","CollettaService",function(e,t,i){return{link:function(n,o){$(o).find("button").on("click",function(){var o=!0,r=$(this).parents("form");$.each(r.find("input[type='file']"),function(e,t){return""!=$(t).val()?(o=!1,!1):void 0}),r.attr("action",t.getServerAddress()+"/"+e.token+"/files/"+i.active.anno),o?n.uploaded&&n.updateInfo():r.ajaxSubmit({type:"POST",uploadProgress:function(e,t,i,o){n.$apply(function(){n.progress=o})},error:function(e,t,i,n){n.removeAttr("action")},success:function(e){var t=$.parseJSON(e);if(void 0!==t.files){n.$apply(function(){n.files.length=0});for(var i in t.files[n.colletta_active.anno])n.$apply(function(){n.files.push({name:i,checked:t.files[n.colletta_active.anno][i].checked})})}n.$apply(function(){n.uploaded=!0}),n.updateInfo()}})})}}}]),collettaApp.directive("toggleAll",function(){return{link:function(e,t){$(t).on("change",function(){$('tbody input[type="checkbox"]').trigger("click")})}}}),collettaApp.directive("isNumber",function(){return{link:function(e){console.log(e.pr),e.$watch("pr.scatole",function(t,i){var n=(t+"").split("");0!==n.length&&(1!==n.length||"-"!=n[0]&&"."!==n[0])&&(2!==n.length||"-."!==t)&&isNaN(t)&&(e.pr.scatole=i)}),e.$watch("pr.kg",function(t,i){var n=(t+"").split("");0!==n.length&&(1!==n.length||"-"!=n[0]&&"."!==n[0])&&(2!==n.length||"-."!==t)&&isNaN(t)&&(e.pr.kg=i)})}}}),collettaApp.factory("filesUpload",["$resource","$routeParams","ServerAddress",function(e,t,i){var n=e(i.getServerAddress()+"/:token/files/:year",{token:t.token,year:"@year"});return n}]),collettaApp.factory("GetInfoFactory",["$resource","ServerAddress",function(e,t){var i=e(t.getServerAddress()+":token/get/:property/:limit_start/:limit_end",{token:"@token",property:"@property",limit_start:"@limit_start",limit_end:"@limit_end"});return i}]),collettaApp.factory("InsertInfoFactory",["$resource","ServerAddress",function(e,t){var i=e(t.getServerAddress()+":token/save/:property",{token:"@token",property:"@property"});return i}]),collettaApp.factory("SetInfoFactory",["$resource","ServerAddress",function(e,t){var i=e(t.getServerAddress()+":token/set/:property",{token:"@token",property:"@property"});return i}]),collettaApp.factory("DeleteInfoFactory",["$resource","ServerAddress",function(e,t){var i=e(t.getServerAddress()+":token/delete/:property",{token:"@token",property:"@property"});return i}]),collettaApp.factory("UserInfoFactory",["$resource","ServerAddress",function(e,t){var i=e(t.getServerAddress()+":token/get/user",{token:"@token"});return i}]),collettaApp.factory("LoginFactory",["$resource","ServerAddress",function(e,t){var i=e(t.getServerAddress()+"login",{});return i}]),collettaApp.factory("LogoutFactory",["$resource","ServerAddress",function(e,t){var i=e(t.getServerAddress()+"logout",{});return i}]),collettaApp.service("CollettaService",["$q",function(e){var t=e.defer();return{collettaDeferred:t,collettaPromise:t.promise,colletta:[],active:"",files:[]}}]),collettaApp.service("ComuniService",["$q",function(e){var t=e.defer();return{def:t,prom:t.promise,comuni:[]}}]),collettaApp.service("ProvincieService",["$q",function(e){var t=e.defer();return{def:t,prom:t.promise,provincie:[]}}]),collettaApp.service("CateneService",["$q",function(e){var t=e.defer();return{def:t,prom:t.promise,catene:[]}}]),collettaApp.service("CapiEquipeService",["$q",function(e){var t=e.defer();return{def:t,prom:t.promise,capi_equipe:{},capi_equipe_array:[],capi_equipe_supermercati:{}}}]),collettaApp.service("UserInfoService",["$q",function(e){function t(e){return $.extend({},{nome:null,cognome:null,email:null,privilegi:null,ruolo:null,telefono:null,username:null,pages:[]},e)}var i=e.defer();return{def:i,prom:i.promise,user:{nome:null,cognome:null,email:null,privilegi:null,ruolo:null,telefono:null,username:null,pages:[]},userObj:function(e){return new t(e)}}}]),collettaApp.service("CaricoService",["$q",function(){return{modalButtons:[{label:"ok",type:"primary",active:!0,action:"ok"},{label:"elimina",type:"danger",active:!0,action:"del"},{label:"annulla",type:"warning",active:!0,action:"dismiss"}],prodottiNomi:[{tipo:"OLIO"},{tipo:"OMOGENIZZATI"},{tipo:"ALIMENTI INFANZIA"},{tipo:"TONNO"},{tipo:"CARNE IN SCATOLA"},{tipo:"PELATI"},{tipo:"LEGUMI"},{tipo:"PASTA"},{tipo:"RISO"},{tipo:"ZUCCHERO"},{tipo:"LATTE"},{tipo:"VARIE"}],modalOptions:{title:"Nuovo Carico",buttons:"Nuovo Carico"},newCarico:[{prodotto:"OLIO",kg:"",scatole:""},{prodotto:"OMOGENIZZATI",kg:"",scatole:""},{prodotto:"ALIMENTI INFANZIA",kg:"",scatole:""},{prodotto:"TONNO",kg:"",scatole:""},{prodotto:"CARNE IN SCATOLA",kg:"",scatole:""},{prodotto:"PELATI",kg:"",scatole:""},{prodotto:"LEGUMI",kg:"",scatole:""},{prodotto:"PASTA",kg:"",scatole:""},{prodotto:"RISO",kg:"",scatole:""},{prodotto:"ZUCCHERO",kg:"",scatole:""},{prodotto:"LATTE",kg:"",scatole:""},{prodotto:"VARIE",kg:"",scatole:""}],caricoTmpl:[{prodotto:"OLIO",kg:"",scatole:""},{prodotto:"OMOGENIZZATI",kg:"",scatole:""},{prodotto:"ALIMENTI INFANZIA",kg:"",scatole:""},{prodotto:"TONNO",kg:"",scatole:""},{prodotto:"CARNE IN SCATOLA",kg:"",scatole:""},{prodotto:"PELATI",kg:"",scatole:""},{prodotto:"LEGUMI",kg:"",scatole:""},{prodotto:"PASTA",kg:"",scatole:""},{prodotto:"RISO",kg:"",scatole:""},{prodotto:"ZUCCHERO",kg:"",scatole:""},{prodotto:"LATTE",kg:"",scatole:""},{prodotto:"VARIE",kg:"",scatole:""}],lastId:null,modifyId:""}}]),collettaApp.service("SupermercatoService",["$q",function(){return{modalButtons:[{label:"ok",type:"primary",active:!0,action:"ok"},{label:"elimina",type:"danger",active:!0,action:"del"},{label:"annulla",type:"warning",active:!0,action:"dismiss"}],modalTitle:"",tmpl:{nome:"",indirizzo:"",id_comune:"",id_catena:"",capi_equipe:[],id_area:1},mod:{}}}]),collettaApp.service("SupermercatiService",["$q",function(){function e(e){return $.extend({},{index:null,checked:!1,id:null,id_supermercato:null,id_colletta:null,colletta:null,id_catena:null,catena:null,nome:null,id_magazzino:null,id_area:null,id_comune:null,provincia:null,comune:null,confermato:null,indirizzo:null,id_diocesi:null,capi_equipe:[]},e)}return{supermercato:function(t){return new e(t)},supermercati:[]}}]),collettaApp.service("ProdottiService",["$q",function(e){var t=e.defer();return{def:t,prom:t.promise,prodotti:[]}}]),collettaApp.service("ServerAddress",function(){var e="../api/index.php/";return{getServerAddress:function(){return e}}}),collettaApp.service("VersionService",function(){return{version:versionTmpl}}),collettaApp.service("AdminPagesService",function(){return{sections:[],section:""}});