function getComuneById(e){var t=null;for(var i in comuni)if(comuni[i].id==e){t=angular.extend({},comuni[i]);break}return t}var comuni=[],versionTmpl="1.1",collettaApp=angular.module("collettaApp",["ngResource","ngRoute","ui.bootstrap","ui.select2"]);collettaApp.config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/login.html?version="+versionTmpl}).when("/:token/home",{templateUrl:"views/home.html?version="+versionTmpl}).when("/:token/gestione_supermercati",{templateUrl:"views/admin/supermercati.html?version="+versionTmpl}).when("/:token/gestione_utenti",{templateUrl:"views/admin/utenti.html?version="+versionTmpl}).when("/:token/gestione_magazzini",{templateUrl:"views/admin/magazzini.html?version="+versionTmpl}).when("/:token/gestione_catene",{templateUrl:"views/admin/catene.html?version="+versionTmpl}).when("/:token/gestione_files",{templateUrl:"views/admin/files.html?version="+versionTmpl}).when("/:token/gestione_report",{templateUrl:"views/user/report.html?version="+versionTmpl}).when("/:token/report_big",{templateUrl:"views/user/report_big.html?version="+versionTmpl}).when("/:token/supermercati",{templateUrl:"views/user/supermercati.html?version="+versionTmpl}).when("/:token/prodotti/:idSupermercato",{templateUrl:"views/user/prodotti.html?version="+versionTmpl}).when("/:token/supermercato/:idSupermercato",{templateUrl:"views/user/supermercato.html?version="+versionTmpl}).when("/:token/supermercato/nuovo",{templateUrl:"views/user/supermercato.html?version="+versionTmpl}).otherwise({redirectTo:"/"})}]),collettaApp.controller("LoginCtrl",["$scope","$resource","$location","LoginFactory","VersionService",function(e,t,i,n,o){e.version=o.version,e.alerts=[],e.closeAlerts=function(){e.alerts=[]},e.username="",e.password="",e.login=function(){if(""!==e.username&&""!==e.password){var t=new n({username:e.username,password:e.password});t.$save(function(){arguments[0].error?e.alerts.push({type:"error",disabled:!1,msg:"Nome utente o password errati, riprova!"}):(e.alerts=[],i.path(arguments[0].token+"/home/"))})}}}]),collettaApp.controller("AdminCtrl",["$scope","$resource","$location","$routeParams","UserInfoService","UserInfoFactory","AdminPagesService","LogoutFactory","VersionService",function(e,t,i,n,o,r,a,s,c){e.version=c.version,e.token=n.token,e.sections=a.sections,e.section=a.section,0==e.sections.length&&(e.sections.push({url:"supermercati",label:"Supermercati",active:!1}),e.sections.push({url:"utenti",label:"Utenti",active:!1}),e.sections.push({url:"magazzini",label:"Magazzini",active:!1})),e.sections.map(function(t){return t.active=t.url==e.section?!0:!1})}]),collettaApp.controller("UserCtrl",["$scope","$resource","$location","$routeParams","GetInfoFactory","SetInfoFactory","UserInfoService","UserInfoFactory","LogoutFactory","VersionService","CollettaService",function(e,t,i,n,o,r,a,s,c,l,u){e.version=l.version,e.activePage=n.page,e.token=n.token,e.user=a.info,e.colletta=u.colletta,e.colletta_active=u.active,e.files=u.files,e.logout=function(){c.get(function(){i.path("/")})},a.getInfo(),u.getInfo()}]),collettaApp.controller("HomeCtrl",["$scope","$resource","$location","$routeParams","UserInfoService","VersionService",function(e,t,i,n,o,r){e.version=r.version,e.token=n.token,e.user=o.info}]);var catene=[];collettaApp.controller("SupermercatiCtrl",["$scope","$q","$resource","$location","$routeParams","GetInfoFactory","SetInfoFactory","SupermercatiService","ComuniService","CateneService","CapiEquipeService","CapiEquipeSupermercatiService","AdminPagesService","CaricoService","VersionService","CollettaService","SupermercatoService","dialogSupermercato","InsertInfoFactory","ProvincieService","AreeService","FilterService","UserInfoService",function(e,t,i,n,o,r,a,s,c,l,u,p,h,d,f,m,g,v,b,y,w,C,S){h.section="supermercati",e.version=f.version,e.initialized=!1,e.supermercati=s.supermercati,e.newSupermercati=s.tmpl,e.checkedAll=0,e.columns=[],e.getComuneById=getComuneById,e.chosenSuperm=2,e.user=S.info,e.colletta=m.colletta,e.provincie=y.provincie,e.comuni=c.comuni,e.aree=w.aree,e.catene=l.catene,e.capi_equipe=u.capi_equipe,e.capi_equipe_array=u.capi_equipe_array,e.capi_equipe_supermercati=p.capi_equipe_supermercati,e.newCapoEquipe=v.newCapoEquipe,e.supermercato=g,e.pagination={page:1,itemsPerPage:50,currentPage:function(){return e.pagination.page*e.pagination.itemsPerPage}},e.filter=C.filter,c.getInfo(),l.getInfo(),w.getInfo(),u.getInfo(),p.getInfo(),e.addCapoEquipe=function(){if(""!=e.newCapoEquipe.nome){var t=new b({values:[{nome:e.newCapoEquipe.nome,email:"",telefono:""}]});t.$save({token:o.token,property:"capi_equipe"},function(t){e.newCapoEquipe.status=0;var i={id:t.capi_equipe.id,nome:e.newCapoEquipe.nome,email:"",telefono:""};e.capi_equipe[t.capi_equipe.id]=i,e.capi_equipe_array.push(i)})}else e.newCapoEquipe.status=0},e.setToggledSupermercati=function(t){var i=new a({values:[{id_supermercato:{IN:e.getAllSupermercatiIds({checked:1})}}],set:[{confermato:t}]});i.$save({token:o.token,property:"supermercati"},function(){})},t.all([u.prom,p.prom,m.prom,c.prom,l.prom]).then(function(){e.initialized=!0,s.getInfo(!1)}),e.getAllSupermercatiIds=function(t){for(var i=[],n=0;e.supermercati.length>n;n++)if("undefined"!=t){var o=!0;for(var r in t)if(e.supermercati[n][r]!=t[r]){o=!1;break}o&&i.push(e.supermercati[n].id)}else i.push(e.supermercati[n].id);return i},e.filterFirst={initSelection:function(e,t){t($(e).data("$ngModelController").$modelValue)}},e.incrementPagination=function(){e.supermercati.length>e.pagination.currentPage()&&e.pagination.page++},e.openProducts=function(e){localStorage.supermercato=JSON.stringify(e),g.getInfo(),n.path("/"+o.token+"/prodotti/"+e.id)},e.openDetails=function(e){localStorage.supermercato=JSON.stringify(e),g.getInfo(),n.path("/"+o.token+"/supermercato/"+e.id)},e.openNew=function(){e.supermercato.resetInfo(),localStorage.supermercato=JSON.stringify(e.supermercato.info),n.path("/"+o.token+"/supermercato/nuovo")},e.addCapoEquipe=function(){if(""!=e.newCapoEquipe.nome){var t=new b({values:[{nome:e.newCapoEquipe.nome,email:"",telefono:""}]});t.$save({token:o.token,property:"capi_equipe"},function(t){e.newCapoEquipe.status=0;var i={id:t.capi_equipe.id,nome:e.newCapoEquipe.nome,email:"",telefono:""};e.capi_equipe[t.capi_equipe.id]=i,e.capi_equipe_array.push(i)})}else e.newCapoEquipe.status=0}}]),collettaApp.filter("range",function(){return function(e,t,i){var n=[];if(void 0!==e){t=parseInt(t),i=parseInt(i);for(var o=t;i>o;o++)e.length>o&&n.push(e[o])}return n}});var prodotti=[],SupermercatoCtrl=function(e,t,i,n,o,r,a,s,c,l,u,p,h,d,f,m){function g(){var i=null,n=e.capi_equipe_supermercati.filter(function(t){return t.id_supermercato===e.supermercato.info.id});if(n.length>0)if(n[0].id_capo_equipe!==e.supermercato.info.capo_equipe.id)i=p.setInfo();else{var o=t.defer();i=o.promise,o.resolve()}else if(""!=e.supermercato.info.capo_equipe.id)i=p.saveInfo();else{var o=t.defer();i=o.promise,o.resolve()}i.then(function(){v()})}function v(){t.all([u.getInfo(!0),p.getInfo(!0)]).then(function(){d.getInfo(!0)})}e.def=t.defer(),e.prom=e.def.promise,e.version=s.version,e.user=m.info,e.comuni=c.comuni,e.catene=l.catene,e.aree=h.aree,e.capi_equipe=u.capi_equipe_array,e.capi_equipe_supermercati=p.capi_equipe_supermercati,l.getInfo(),c.getInfo(),h.getInfo(),u.getInfo(),p.getInfo(),e.modalTitle=f.modalTitle,e.modalButtons=f.modalButtons,e.newCapoEquipe=f.newCapoEquipe,e.supermercato=a,e.supermercato.getInfo(),e.editOrAddSupermercato=function(){var t=null;t=""!==e.supermercato.info.id&&null!==e.supermercato.info.id?e.supermercato.setInfo():e.supermercato.addInfo(),t.then(function(){g()})}};SupermercatoCtrl.$inject=["$scope","$q","$resource","$location","$routeParams","GetInfoFactory","SupermercatoService","VersionService","ComuniService","CateneService","CapiEquipeService","CapiEquipeSupermercatiService","AreeService","SupermercatiService","dialogSupermercato","UserInfoService"];var prodotti=[];collettaApp.controller("ProdottiCtrl",["$scope","$resource","$location","$modal","$routeParams","GetInfoFactory","InsertInfoFactory","SetInfoFactory","DeleteInfoFactory","ComuniService","CateneService","CapiEquipeService","CaricoService","VersionService","ProdottiService",function(e,t,i,n,o,r,a,s,c,l,u,p,h,d,f){function m(){var t=e.prodotti.length>0?parseInt(e.prodotti[e.prodotti.length-1].id):0,i=e.caricoTmpl.map(function(e){return $.extend({},{id_supermercato:o.idSupermercato,id_user:"",prodotto:e.prodotto,kg:""!=e.kg?e.kg:0,scatole:""!=e.scatole?e.scatole:0,carico:t+1})}),n=new a({values:i});n.$save({token:o.token,property:"prodotti"},function(){e.$emit("refresh")})}function g(t){var i=[],n=[];t.objects.map(function(e){i.push(e),n.push({id:e.id})});var r=new s({values:i,set:n});r.$save({token:o.token,property:"prodotti"},function(){e.$emit("refresh")})}function v(){for(var t=[],i=[],n=0;e.prodotti.length>n;n++)for(var r=0;e.prodotti[n].objects.length>r;r++)e.prodotti[n].objects[r].carico=n+1,t.push({carico:e.prodotti[n].objects[r].carico}),i.push({id:e.prodotti[n].objects[r].id});var a=new s({values:t,set:i});a.$save({token:o.token,property:"prodotti"},function(){e.$emit("refresh")})}function b(t){var i,n=[],r=[];e.prodotti.map(function(e,n){e.id==t.id&&(i=n)}),t.objects.map(function(e){r.push({id:e.id})}),e.prodotti.splice(i,1);var a=new c({values:n,set:r});a.$save({token:o.token,property:"prodotti"},function(){v()})}e.version=d.version,e.view=1,e.supermercato=null,e.prodottiNomi=h.prodottiNomi,e.caricoTmpl=h.caricoTmpl,e.prodotti=f.prodotti,e.prodottiByTipo=[],e.prodottiByTipoTotal=[],e.Total={kg:0,scatole:0},e.prodottiCarichi={},e.prodottiLength=0,e.lastCarico=1,e.modifyId=h.modifyId,e.getSupermercatoById=function(){e.supermercato=$.parseJSON(localStorage.supermercato)},e.getCarichiByIdSupermercato=function(){var t=new r({id_supermercato:o.idSupermercato});t.$save({token:o.token,property:"prodotti"},function(){if(void 0!==t.prodotti){e.prodotti.length=0;var i=_.groupBy(t.prodotti,function(e){return parseInt(e.carico)});e.prodottiByTipo=_.groupBy(t.prodotti,function(e){return e.prodotto});var n=1;for(var o in i)e.prodotti.push($.extend({},{id:i[o][0].carico,objects:i[o]})),n++;e.getProdottiByTipoTotal(),e.prodottiLength=e.prodotti.length,h.lastId=e.prodottiLength>0?e.prodotti[e.prodotti.length-1].objects[0].carico:0}})},e.$on("refresh",function(){e.getCarichiByIdSupermercato(),e.getSupermercatoById()}),e.$emit("refresh"),e.isNaN=isNaN,e.parseInt=parseInt,e.getCaricoTotal=function(e){for(var t={kg:0,scatole:0},i=0;e.length>i;i++)t.kg+=parseFloat(e[i].kg),t.scatole+=parseFloat(e[i].scatole);return t},e.getProdottiByTipoTotal=function(){e.Total={kg:0,scatole:0},e.prodottiByTipoTotal.length=0;for(var t in e.prodottiByTipo){for(var i={type:t,kg:0,scatole:0},n=0;e.prodottiByTipo[t].length>n;n++)i.kg+=parseFloat(e.prodottiByTipo[t][n].kg),i.scatole+=parseFloat(e.prodottiByTipo[t][n].scatole);e.Total.kg+=parseFloat(i.kg),e.Total.scatole+=parseFloat(i.scatole),e.prodottiByTipoTotal.push(i)}},e.openNewCarico=function(){h.modalTitle="Nuovo Carico",h.modalButtons[0].active=!0,h.modalButtons[1].active=!1,h.modalButtons[2].active=!0,e.caricoTmpl.map(function(e,t){return $.extend(e,h.newCarico[t])});var t=n.open({templateUrl:"caricoNewModal.html",controller:CaricoCtrl,resolve:{}});t.result.then(function(e){"ok"==e&&m()},function(){})},e.openSetCarico=function(t){e.modifyId=h.modifyId=t.id,h.modalTitle="Modifica Carico",h.modalButtons[0].active=!0,h.modalButtons[1].active=!0,h.modalButtons[2].active=!0,e.modifyId=t.ordine;var i=n.open({templateUrl:"caricoEditModal.html",controller:CaricoCtrl,resolve:{}});i.result.then(function(e){"ok"==e?g(t):"del"==e&&b(t)},function(){})}}]);var prodotti=[],CaricoCtrl=function(e,t,i,n,o,r,a,s,c){e.version=s.version,e.prodotti=c.prodotti,e.columns=r.prodottiNomi,e.modifyId=r.modifyId,e.caricoTmpl=r.caricoTmpl,e.carico=e.prodotti.filter(function(t){return t.id==e.modifyId})[0],e.lastId=r.lastId,e.modalTitle=r.modalTitle,e.modalButtons=r.modalButtons,e.closeModal=function(e){a.close(e)}};CaricoCtrl.$inject=["$scope","$resource","$location","$routeParams","GetInfoFactory","CaricoService","$modalInstance","VersionService","ProdottiService"],collettaApp.controller("CateneCtrl",["$scope","$resource","$location","$routeParams","GetInfoFactory","CaricoService","VersionService",function(e,t,i,n,o,r,a){e.version=a.version}]),collettaApp.controller("FilesCtrl",["$scope","$resource","$q","$location","$routeParams","ServerAddress","SetInfoFactory","UserInfoService","VersionService","filesUpload","CollettaService","SupermercatiService","ComuniService","CateneService","AreeService","CapiEquipeService","CapiEquipeSupermercatiService",function(e,t,i,n,o,r,a,s,c,l,u,p,h,d,f,m,g){e.version=c.version,e.token=o.token,e.colletta=u.colletta,e.colletta_active=u.active,e.uploaded=1,e.files=u.files,e.progress=0,e.collettaPromise=u.collettaPromise,u.prom.then(function(){e.colletta_active=e.colletta.filter(function(e){return"1"==e.attiva})[0];var t=l.get({year:e.colletta_active.anno},function(){e.files.length=0;for(var i in t.files[e.colletta_active.anno])e.files.push({name:i,checked:t.files[e.colletta_active.anno][i].checked,status:t.files[e.colletta_active.anno][i].checked?1:0}),t.files[e.colletta_active.anno][i].checked||(e.uploaded=0)})}),e.getChecked=function(){for(var t=!0,i=0;e.files.length>i;i++)0==e.files[i].status&&(t=!1);return t},e.updateInfo=function(){var i=t(r.getServerAddress()+"/:token/info/update/:year",{token:o.token,year:e.colletta_active.anno}),n=i.get(function(){void 0!==n.result})},e.changeCollettaActive=function(t){for(var n=[],r=[],s=0;e.colletta.length>s;s++)e.colletta[s].attiva=e.colletta[s].anno==t.anno?!0:!1,n.push(e.colletta[s]),r.push({id:e.colletta[s].id});var c=new a({values:n,set:r});c.$save({token:o.token,property:"colletta"},function(){i.all([h.getInfo(!1),d.getInfo(!1),m.getInfo(!1),f.getInfo(!1),g.getInfo(!1)]).then(function(){p.getInfo(!0)})})}}]);var catene=[];collettaApp.controller("ReportCtrl",["$scope","$q","$resource","$location","$routeParams","$modal","GetInfoFactory","SetInfoFactory","UserInfoService","SupermercatiService","ComuniService","CateneService","CapiEquipeService","AdminPagesService","CaricoService","VersionService","CollettaService","SupermercatoService","InsertInfoFactory","ProvincieService","ReportService",function(e,t,i,n,o,r,a,s,c,l,u,p,h,d,f,m,g,v,b,y,w){d.section="report",e.version=m.version,e.tableView=!1,e.report=w.report,e.reportByComuni=w.reportByComuni,e.reportByComuniArray=w.reportByComuniArray,e.reportByProvincie={},e.newSupermercati=l.tmpl,e.colletta=g.colletta,e.user=c.info,e.searchForm=1,e.checkedAll=0,e.columns=[],e.getComuneById=getComuneById,e.provincie=y.provincie,e.comuni=u.comuni,e.catene=p.catene,e.supTmpl=v.tmpl,e.prodottiNomi=f.prodottiNomi,e.tipiTotali={};for(var C in e.prodottiNomi)e.tipiTotali[e.prodottiNomi[C].tipo]={tipo:e.prodottiNomi[C].tipo,kg:0,scatole:0};e.totaliComplessivi=w.totaliComplessivi,e.prodotti=[],e.prodottiByTipo=[],e.prodottiByTipoTotal=[],e.Total={kg:0,scatole:0},e.prodottiCarichi={},e.pagination={page:1,itemsPerPage:50,currentPage:function(){return e.pagination.page*e.pagination.itemsPerPage}},e.limitDecimal=function(e){return void 0!==e?(isNaN(e)&&(e=parseFloat(e)),0===e%1?e:e.toFixed(2)):void 0},e.parseInt=function(e){return Math.round(e)},e.search={visible:!0,provincia:"",comune:"",catena:"",colletta:"",comuniId:[]},g.prom.then(function(){e.search.colletta=g.active.id}),u.getInfo(!1),p.getInfo(!1),e.getSupermercati=function(){var t={};null!=e.search.comune&&""!=e.search.comune?t.id_comune=e.search.comune:null!=e.search.provincia&&""!=e.search.provincia?t.id_provincia=e.search.provincia:null!=e.search.colletta&&""!=e.search.colletta&&(t.id_colletta=e.search.colletta);var i=new a(t);e.report.length=0,e.reportByComuni=w.reportByComuni={},e.reportByComuniArray.length=0,e.totaliComplessivi.tipiArray=[],e.totaliComplessivi.tipi=$.extend(!0,[],f.prodottiTmpl),e.totaliComplessivi.complessivo={kg:0,scatole:0,carichi:0},i.$save({token:o.token,property:"report"},function(){for(var t=0;i.report.length>t;t++){i.report[t].catena=e.catene.filter(function(e){return e.id==i.report[t].id_catena})[0],i.report[t].enabled=i.report[t].prodotti.length>0?!0:!1,void 0===e.reportByComuni[i.report[t].id_comune]&&(e.reportByComuni[i.report[t].id_comune]={nome:e.comuni.filter(function(e){return e.id==i.report[t].id_comune})[0].nome,objects:[],complessivo:{kg:0,scatole:0,carichi:[]},totali:$.extend(!0,[],f.prodottiTmpl),enabled:!1});var n=e.reportByComuni[i.report[t].id_comune];n.objects.push(i.report[t]),i.report[t].prodotti.length>0&&(n.enabled=!0),$.extend(!0,{},e.tipiTotali),i.report[t].totali={kg:0,scatole:0};for(var o=0;i.report[t].prodotti.length>o;o++){i.report[t].prodotti[o].Kg=parseInt(i.report[t].prodotti[o].Kg),i.report[t].prodotti[o].scatole=parseInt(i.report[t].prodotti[o].scatole);var r=n.totali.filter(function(e){return e.prodotto==i.report[t].prodotti[o].prodotto})[0],a=e.totaliComplessivi.tipi.filter(function(e){return e.prodotto==i.report[t].prodotti[o].prodotto})[0];i.report[t].totali.kg+=i.report[t].prodotti[o].Kg,i.report[t].totali.scatole+=i.report[t].prodotti[o].scatole,r.kg+=i.report[t].prodotti[o].Kg,r.scatole+=i.report[t].prodotti[o].scatole,n.complessivo.kg+=i.report[t].prodotti[o].Kg,n.complessivo.scatole+=i.report[t].prodotti[o].scatole,a.kg+=i.report[t].prodotti[o].Kg,a.scatole+=i.report[t].prodotti[o].scatole,e.totaliComplessivi.complessivo.kg+=i.report[t].prodotti[o].Kg,e.totaliComplessivi.complessivo.scatole+=i.report[t].prodotti[o].scatole}i.report[t].comune=n.nome,i.report[t].catena=e.catene.filter(function(e){return e.id==i.report[t].id_catena})[0],e.report.push($.extend(!0,{},i.report[t]))}for(var t in e.reportByComuni)e.reportByComuniArray.push(e.reportByComuni[t]);e.search.visible=!1})},e.getAllSupermercatiIds=function(t){var i=[];for(var n in e.report)if("undefined"!=t){var o=!0;for(var r in t)if(e.report[n][r]!=t[r]){o=!1;break}o&&i.push(e.report[n].id)}else i.push(e.report[n].id);return i},e.filterFirst={initSelection:function(e,t){t($(e).data("$ngModelController").$modelValue)}},e.getCaricoTotal=function(e){for(var t={kg:0,scatole:0},i=0;e.length>i;i++)t.kg+=parseFloat(e[i].kg),t.scatole+=parseFloat(e[i].scatole);return t},e.getProdottiByTipoTotal=function(){e.Total={kg:0,scatole:0},e.prodottiByTipoTotal.length=0;for(var t in e.prodottiByTipo){for(var i={type:t,kg:0,scatole:0},n=0;e.prodottiByTipo[t].length>n;n++)i.kg+=parseFloat(e.prodottiByTipo[t][n].kg),i.scatole+=parseFloat(e.prodottiByTipo[t][n].scatole);e.Total.kg+=parseFloat(i.kg),e.Total.scatole+=parseFloat(i.scatole),e.prodottiByTipoTotal.push(i)}}}]),collettaApp.filter("range",function(){return function(e,t,i){var n=[];if(void 0!==e){t=parseInt(t),i=parseInt(i);for(var o=t;i>o;o++)e.length>o&&n.push(e[o])}return n}}),collettaApp.directive("myUploader",["$routeParams","ServerAddress","CollettaService",function(){return{link:function(e,t){$(t).find(".fake-uploader").on("click",function(){$(this).parent().find('input[type="file"]').trigger("click")}),$(t).find(".fake-uploader").on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),$(t).find(".fake-uploader").on("dragenter",function(e){e.preventDefault(),e.stopPropagation()}),$(t).find(".fake-uploader").on("drop",function(e){e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length&&(e.preventDefault(),e.stopPropagation(),$(this).parent().children("input[type='file']").prop("files",e.originalEvent.dataTransfer.files))}),$(t).find('input[type="file"]').on("change",function(){e.$parent.$apply(function(){e.$parent.uploaded=!1}),$(t).find(".status-2").show(),e.$apply(function(){e.file.status=2})})}}}]),collettaApp.directive("myUpload",["$routeParams","ServerAddress","CollettaService",function(e,t,i){return{link:function(n,o){$(o).find("button").on("click",function(){var o=!0,r=$(this).parents("form");$.each(r.find("input[type='file']"),function(e,t){return""!=$(t).val()?(o=!1,!1):void 0}),r.attr("action",t.getServerAddress()+"/"+e.token+"/files/"+i.active.anno),o?n.uploaded&&n.updateInfo():r.ajaxSubmit({type:"POST",uploadProgress:function(e,t,i,o){n.$apply(function(){n.progress=o})},error:function(e,t,i,n){n.removeAttr("action")},success:function(e){var t=$.parseJSON(e);if(void 0!==t.files){n.$apply(function(){n.files.length=0});for(var i in t.files[n.colletta_active.anno])n.$apply(function(){n.files.push({name:i,checked:t.files[n.colletta_active.anno][i].checked})})}n.$apply(function(){n.uploaded=!0}),n.updateInfo()}})})}}}]),collettaApp.directive("toggleAll",function(){return{link:function(e,t){$(t).on("change",function(){$('tbody input[type="checkbox"]').trigger("click")})}}}),collettaApp.directive("isNumber",function(){return{link:function(e){e.$watch("pr.scatole",function(t,i){var n=(t+"").split("");0!==n.length&&(1!==n.length||"-"!=n[0]&&"."!==n[0])&&(2!==n.length||"-."!==t)&&isNaN(t)&&(e.pr.scatole=i)}),e.$watch("pr.kg",function(t,i){var n=(t+"").split("");0!==n.length&&(1!==n.length||"-"!=n[0]&&"."!==n[0])&&(2!==n.length||"-."!==t)&&isNaN(t)&&(e.pr.kg=i)})}}}),collettaApp.factory("filesUpload",["$resource","$routeParams","ServerAddress",function(e,t,i){var n=e(i.getServerAddress()+"/:token/files/:year",{token:t.token,year:"@year"});return n}]),collettaApp.factory("GetInfoFactory",["$resource","ServerAddress",function(e,t){var i=e(t.getServerAddress()+":token/get/:property/:limit_start/:limit_end",{token:"@token",property:"@property",limit_start:"@limit_start",limit_end:"@limit_end"});return i}]),collettaApp.factory("InsertInfoFactory",["$resource","ServerAddress",function(e,t){var i=e(t.getServerAddress()+":token/save/:property",{token:"@token",property:"@property"});return i}]),collettaApp.factory("SetInfoFactory",["$resource","ServerAddress",function(e,t){var i=e(t.getServerAddress()+":token/set/:property",{token:"@token",property:"@property"});return i}]),collettaApp.factory("DeleteInfoFactory",["$resource","ServerAddress",function(e,t){var i=e(t.getServerAddress()+":token/delete/:property",{token:"@token",property:"@property"});return i}]),collettaApp.factory("UserInfoFactory",["$resource","ServerAddress",function(e,t){var i=e(t.getServerAddress()+":token/get/user",{token:"@token"});return i}]),collettaApp.factory("LoginFactory",["$resource","ServerAddress",function(e,t){var i=e(t.getServerAddress()+"login",{});return i}]),collettaApp.factory("LogoutFactory",["$resource","ServerAddress",function(e,t){var i=e(t.getServerAddress()+"logout",{});return i}]),collettaApp.service("CollettaService",["$q","GetInfoFactory","$routeParams",function(e,t,i){var n=e.defer();return{def:n,prom:n.promise,colletta:[],active:"",files:[],getInfo:function(){var e=this,n=new t,o=n.$save({token:i.token,property:"colletta"},function(){e.colletta.length=0;for(var t=0;n.colletta.length>t;t++)e.colletta.push($.extend(n.colletta[t],{attiva:1==n.colletta[t].attiva?!0:!1}));for(var t=0;e.colletta.length>t;t++)e.colletta[t].attiva&&(e.active=$.extend({},e.colletta[t]));e.def.resolve()});return o}}}]),collettaApp.service("ComuniService",["$q","GetInfoFactory","ProvincieService","$routeParams",function(e,t,i,n){var o=e.defer();return{def:o,prom:o.promise,comuni:[],getInfo:function(e){var o=this;if(e||0==o.comuni.length){var r=new t;r.$save({token:n.token,property:"comuni"},function(){for(var e=0;r.comuni.length>e;e++)o.comuni.push(r.comuni[e]);var t=_.uniq(o.comuni.map(function(e){return{id:e.id_provincia,nome:e.provincia}}),"id");i.provincie.length=0;for(var e=0;t.length>e;e++)i.provincie[e]=$.extend({},t[e]);o.def.resolve()})}else o.def.resolve()}}}]),collettaApp.service("ProvincieService",["$q",function(e){var t=e.defer();return{def:t,prom:t.promise,provincie:[]}}]),collettaApp.service("AreeService",["$q","GetInfoFactory","$routeParams",function(e,t,i){var n=e.defer();return{def:n,prom:n.promise,aree:[],getInfo:function(e){var n=this;if(e||0==n.aree.length){var o=new t;o.$save({token:i.token,property:"aree"},function(){for(var e=0;o.aree.length>e;e++)n.aree.push(o.aree[e]);n.def.resolve()})}else n.def.resolve()}}}]),collettaApp.service("CateneService",["$q","GetInfoFactory","$routeParams",function(e,t,i){var n=e.defer();return{def:n,prom:n.promise,catene:[],getInfo:function(e){var n=this;if(e||0==n.catene.length){var o=new t;o.$save({token:i.token,property:"catene"},function(){for(var e=0;o.catene.length>e;e++)n.catene.push(o.catene[e]);n.def.resolve()})}else n.def.resolve()}}}]),collettaApp.service("CapiEquipeService",["$q","GetInfoFactory","$routeParams",function(e,t,i){var n=e.defer();return{def:n,prom:n.promise,capi_equipe:{},capi_equipe_array:[],getInfo:function(e){var n=this;if(0==n.capi_equipe_array.length||e){var o=new t,r=o.$save({token:i.token,property:"capi_equipe"},function(){for(var e=0;o.capi_equipe.length>e;e++)n.capi_equipe[o.capi_equipe[e].id]=$.extend({supermercati:[]},o.capi_equipe[e]),n.capi_equipe_array.push(n.capi_equipe[o.capi_equipe[e].id]);n.def.resolve()});return r}n.def.resolve()}}}]),collettaApp.service("CapiEquipeSupermercatiService",["$q","GetInfoFactory","InsertInfoFactory","SetInfoFactory","$routeParams","SupermercatoService",function(e,t,i,n,o,r){var a=e.defer();return{def:a,prom:a.promise,capi_equipe_supermercati:[],getInfo:function(e){var i=null,n=this;if(e||0===n.capi_equipe_supermercati.length){var r=new t;return i=r.$save({token:o.token,property:"capi_equipe_supermercati"},function(){n.capi_equipe_supermercati.length=0;for(var e=0;r.capi_equipe_supermercati.length>e;e++)n.capi_equipe_supermercati.push(r.capi_equipe_supermercati[e]);n.def.resolve()})}},saveInfo:function(){var e=new i({values:[{id_capo_equipe:r.info.capo_equipe.id,id_supermercato:r.info.id}]}),t=e.$save({token:o.token,property:"capi_equipe_supermercati"},function(){});return t},setInfo:function(){var e=new n({values:[{id_capo_equipe:r.info.capo_equipe.id,id_supermercato:r.info.id}],set:[{id_supermercato:r.info.id}]}),t=e.$save({token:o.token,property:"capi_equipe_supermercati"},function(){});return t}}}]),collettaApp.service("UserInfoService",["$q","$location","GetInfoFactory","$routeParams","UserInfoFactory",function(e,t,i,n,o){function r(e){return $.extend({},{nome:null,cognome:null,email:null,privilegi:null,ruolo:null,telefono:null,username:null,pages:[]},e)}var a=e.defer();return{def:a,prom:a.promise,info:{nome:null,cognome:null,email:null,privilegi:null,ruolo:null,telefono:null,username:null,pages:[]},userObj:function(e){return new r(e)},getInfo:function(){var e=this,i=o.get({token:n.token},function(){if(i.error)t.path("/");else{switch($.extend(e.info,i.user),e.info.pages.length=0,e.info.pages.push({url:"supermercati",label:"Gestione Carichi",selected:0}),e.info.pages.push({url:"gestione_report",label:"Report",selected:0}),parseInt(e.info.privilegi)){case 1:e.info.pages.push({url:"gestione_files",label:"Upload",selected:0})}e.def.resolve()}})}}}]),collettaApp.service("CaricoService",["$q",function(){return{modalButtons:[{label:"ok",type:"primary",active:!0,action:"ok"},{label:"elimina",type:"danger",active:!0,action:"del"},{label:"annulla",type:"warning",active:!0,action:"dismiss"}],prodottiNomi:[{tipo:"OLIO"},{tipo:"OMOGENIZZATI"},{tipo:"ALIMENTI INFANZIA"},{tipo:"TONNO"},{tipo:"CARNE IN SCATOLA"},{tipo:"PELATI"},{tipo:"LEGUMI"},{tipo:"PASTA"},{tipo:"RISO"},{tipo:"ZUCCHERO"},{tipo:"LATTE"},{tipo:"VARIE"}],prodottiTmpl:[{prodotto:"OLIO",kg:0,scatole:0},{prodotto:"OMOGENIZZATI",kg:0,scatole:0},{prodotto:"ALIMENTI INFANZIA",kg:0,scatole:0},{prodotto:"TONNO",kg:0,scatole:0},{prodotto:"CARNE IN SCATOLA",kg:0,scatole:0},{prodotto:"PELATI",kg:0,scatole:0},{prodotto:"LEGUMI",kg:0,scatole:0},{prodotto:"PASTA",kg:0,scatole:0},{prodotto:"RISO",kg:0,scatole:0},{prodotto:"ZUCCHERO",kg:0,scatole:0},{prodotto:"LATTE",kg:0,scatole:0},{prodotto:"VARIE",kg:0,scatole:0}],modalOptions:{title:"Nuovo Carico",buttons:"Nuovo Carico"},newCarico:[{prodotto:"OLIO",kg:"",scatole:""},{prodotto:"OMOGENIZZATI",kg:"",scatole:""},{prodotto:"ALIMENTI INFANZIA",kg:"",scatole:""},{prodotto:"TONNO",kg:"",scatole:""},{prodotto:"CARNE IN SCATOLA",kg:"",scatole:""},{prodotto:"PELATI",kg:"",scatole:""},{prodotto:"LEGUMI",kg:"",scatole:""},{prodotto:"PASTA",kg:"",scatole:""},{prodotto:"RISO",kg:"",scatole:""},{prodotto:"ZUCCHERO",kg:"",scatole:""},{prodotto:"LATTE",kg:"",scatole:""},{prodotto:"VARIE",kg:"",scatole:""}],caricoTmpl:[{prodotto:"OLIO",kg:"",scatole:""},{prodotto:"OMOGENIZZATI",kg:"",scatole:""},{prodotto:"ALIMENTI INFANZIA",kg:"",scatole:""},{prodotto:"TONNO",kg:"",scatole:""},{prodotto:"CARNE IN SCATOLA",kg:"",scatole:""},{prodotto:"PELATI",kg:"",scatole:""},{prodotto:"LEGUMI",kg:"",scatole:""},{prodotto:"PASTA",kg:"",scatole:""},{prodotto:"RISO",kg:"",scatole:""},{prodotto:"ZUCCHERO",kg:"",scatole:""},{prodotto:"LATTE",kg:"",scatole:""},{prodotto:"VARIE",kg:"",scatole:""}],lastId:null,modifyId:""}}]),collettaApp.service("SupermercatoService",["$q","$routeParams","SetInfoFactory","InsertInfoFactory","CollettaService","ComuniService",function(e,t,i,n,o,r){function a(e){return{id:void 0!==e.id?e.id:"",nome:void 0!==e.nome?e.nome:"",indirizzo:void 0!==e.indirizzo?e.indirizzo:"",id_comune:void 0!==e.id_comune?e.id_comune:"",id_provincia:void 0!==e.id_provincia?e.id_provincia:"",id_catena:void 0!==e.id_catena?e.id_catena:"",id_area:void 0!==e.id_area?e.id_area:"",id_colletta:void 0!==e.id_colletta?e.id_colletta:"",capo_equipe:void 0!==e.capo_equipe?e.capo_equipe:{nome:"",id:""}}}var s=e.defer();return{def:s,prom:s.promise,mod:{},info:{},getInfo:function(){$.extend(!0,this.info,a($.parseJSON(localStorage.supermercato)))},resetInfo:function(){$.extend(!0,this.info,a({}))},setInfo:function(){var e=this,n=$.extend({},e.info);delete n.capo_equipe;var o=new i({values:[n],set:[{id:n.id}]}),r=o.$save({token:t.token,property:"supermercati"},function(){localStorage.supermercato=JSON.stringify(e.info),e.getInfo()});return r},addInfo:function(){var e=this,i=null,a=$.extend({},e.info);delete a.capo_equipe,a.id_colletta=o.colletta.filter(function(e){return 1==e.attiva})[0].id,a.id_provincia=r.comuni.filter(function(t){return t.id==e.info.id_comune})[0].id_provincia;var s=new n({values:[a]}),i=s.$save({token:t.token,property:"supermercati"},function(){});return i}}}]),collettaApp.service("SupermercatiService",["$q","$routeParams","GetInfoFactory","CollettaService","ComuniService","CapiEquipeService","CapiEquipeSupermercatiService","CateneService","FilterService",function(e,t,i,n,o,r,a,s,c){function l(e){return $.extend({},{index:null,checked:!1,id:null,id_supermercato:null,id_colletta:null,colletta:null,id_catena:null,catena:null,nome:null,id_magazzino:null,id_area:null,id_comune:null,provincia:null,comune:null,confermato:null,indirizzo:null,id_diocesi:null,capo_equipe:{nome:"",id:""}},e)}var u=e.defer();return{supermercato:function(e){return new l(e)},def:u,prom:u.promise,supermercati:[],getInfo:function(e){var l=this;if(e||0==l.supermercati.length){var u=new i({id_colletta:n.colletta.filter(function(e){return 1==e.attiva})[0].id});u.$save({token:t.token,property:"supermercati"},function(){l.supermercati.length=0;for(var e=0;a.capi_equipe_supermercati.length>e;e++){var t=a.capi_equipe_supermercati[e];void 0!==r.capi_equipe[t.id_capo_equipe]&&r.capi_equipe[t.id_capo_equipe].supermercati.push(t.id_supermercato)}for(var e=0;u.supermercati.length>e;e++){u.supermercati[e].catena=s.catene.filter(function(t){return t.id==u.supermercati[e].id_catena})[0],u.supermercati[e].comune=o.comuni.filter(function(t){return t.id==u.supermercati[e].id_comune}).map(function(e){return e.nome})[0],u.supermercati[e].provincia=o.comuni.filter(function(t){return t.id==u.supermercati[e].id_comune}).map(function(e){return e.provincia})[0];for(var i in r.capi_equipe)void 0!==r.capi_equipe[i].supermercati&&-1!=r.capi_equipe[i].supermercati.indexOf(u.supermercati[e].id)&&(u.supermercati[e].capo_equipe=$.extend({},r.capi_equipe[i]));l.supermercati.push(l.supermercato(u.supermercati[e]))}c.filter.visible=!1})}}}}]),collettaApp.service("ProdottiService",["$q",function(e){var t=e.defer();
return{def:t,prom:t.promise,prodotti:[]}}]),collettaApp.service("ServerAddress",function(){var e="../api/index.php/";return{getServerAddress:function(){return e}}}),collettaApp.service("VersionService",function(){return{version:versionTmpl}}),collettaApp.service("AdminPagesService",function(){return{sections:[],section:""}}),collettaApp.service("FilterService",function(){return{filter:{visible:!0,nome:"",indirizzo:"",provincia:"",comune:"",catena:"",capoEquipe:""}}}),collettaApp.service("ReportService",["$q","GetInfoFactory","$routeParams","CaricoService",function(e,t,i,n){var o=e.defer();return{def:o,prom:o.promise,report:[],reportByComuni:{},reportByComuniArray:[],totaliComplessivi:{tipiArray:[],tipi:$.extend(!0,[],n.prodottiTmpl),complessivo:{kg:0,scatole:0,carichi:0}},getInfo:function(e){var t=this;e||0==t.report.length||t.def.resolve()}}}]),angular.module("collettaApp").service("dialogSupermercato",function(){return{modalButtons:[{label:"ok",type:"primary",active:!0,action:"ok"},{label:"elimina",type:"danger",active:!0,action:"del"},{label:"annulla",type:"warning",active:!0,action:"dismiss"}],modalTitle:{info:""},newCapoEquipe:{status:0,nome:""}}});